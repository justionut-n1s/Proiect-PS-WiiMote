#:import dp kivy.metrics.dp

# =========================================================
# ROOT
# =========================================================
<RootLayout@FloatLayout>:
    canvas.before:
        Color:
            rgba: 0.96, 0.96, 0.96, 1
        Rectangle:
            pos: self.pos
            size: self.size

    # ================= SETTINGS =================
    Button:
        size_hint: None, None
        size: dp(42), dp(42)
        pos_hint: {"right": 0.98, "top": 0.98}
        background_normal: "assets/icons/setting.png"
        background_down: "assets/icons/setting.png"
        border: 0,0,0,0
        allow_stretch: True
        keep_ratio: True
        on_press: self.opacity = 0.6
        on_release:
            self.opacity = 1
            app.open_settings()

    # ================= D-PAD =================
    FloatLayout:
        size_hint: None, None
        size: dp(220), dp(220)
        pos_hint: {"center_x": 0.5, "top": 0.82}

        Button:
            text: "↑"
            font_size: "1sp"
            color: 0,0,0,0
            size_hint: None, None
            size: dp(64), dp(64)
            pos_hint: {"center_x": 0.5, "top": 1}
            background_normal: "assets/icons/up-arrow.png"
            background_down: "assets/icons/up-arrow.png"
            border: 0,0,0,0
            allow_stretch: True
            keep_ratio: True
            on_press: self.opacity = 0.6
            on_release: self.opacity = 1

        Button:
            text: "←"
            font_size: "1sp"
            color: 0,0,0,0
            size_hint: None, None
            size: dp(64), dp(64)
            pos_hint: {"x": 0, "center_y": 0.5}
            background_normal: "assets/icons/left-arrow.png"
            background_down: "assets/icons/left-arrow.png"
            border: 0,0,0,0
            allow_stretch: True
            keep_ratio: True
            on_press: self.opacity = 0.6
            on_release: self.opacity = 1

        Button:
            text: "→"
            font_size: "1sp"
            color: 0,0,0,0
            size_hint: None, None
            size: dp(64), dp(64)
            pos_hint: {"right": 1, "center_y": 0.5}
            background_normal: "assets/icons/right-arrow.png"
            background_down: "assets/icons/right-arrow.png"
            border: 0,0,0,0
            allow_stretch: True
            keep_ratio: True
            on_press: self.opacity = 0.6
            on_release: self.opacity = 1

        Button:
            text: "↓"
            font_size: "1sp"
            color: 0,0,0,0
            size_hint: None, None
            size: dp(64), dp(64)
            pos_hint: {"center_x": 0.5, "y": 0}
            background_normal: "assets/icons/down-arrow.png"
            background_down: "assets/icons/down-arrow.png"
            border: 0,0,0,0
            allow_stretch: True
            keep_ratio: True
            on_press: self.opacity = 0.6
            on_release: self.opacity = 1

    # ================= A =================
    Button:
        text: "A"
        font_size: "28sp"
        color: 1,1,1,1
        size_hint: None, None
        size: dp(110), dp(110)
        pos_hint: {"x": 0.15, "center_y": 0.45}
        background_normal: ""
        background_color: 0.52, 0.34, 0.82, 1
        on_press: self.opacity = 0.7
        on_release: self.opacity = 1

    # ================= B =================
    Button:
        text: "B"
        font_size: "28sp"
        color: 0.2,0.2,0.2,1
        size_hint: None, None
        size: dp(110), dp(110)
        pos_hint: {"right": 0.85, "center_y": 0.45}
        background_normal: ""
        background_color: 0,0,0,0
        on_press: self.opacity = 0.7
        on_release: self.opacity = 1
        canvas.before:
            Color:
                rgba: 0.92,0.92,0.92,1
            Ellipse:
                pos: self.pos
                size: self.size

    # ================= - & + =================
    Button:
        text: "-"
        font_size: "26sp"
        size_hint: None, None
        size: dp(48), dp(48)
        pos_hint: {"x": 0.3, "center_y": 0.32}
        background_normal: ""
        background_color: 0.96,0.96,0.96,1
        on_press: self.opacity = 0.6
        on_release: self.opacity = 1

    Button:
        text: "+"
        font_size: "26sp"
        size_hint: None, None
        size: dp(48), dp(48)
        pos_hint: {"right": 0.7, "center_y": 0.32}
        background_normal: ""
        background_color: 0.96,0.96,0.96,1
        on_press: self.opacity = 0.6
        on_release: self.opacity = 1

    # ================= 2 & 1 =================
    Button:
        text: "2"
        font_size: "22sp"
        size_hint: None, None
        size: dp(70), dp(70)
        pos_hint: {"x": 0.25, "center_y": 0.18}
        background_normal: ""
        background_color: 0,0,0,0
        on_press: self.opacity = 0.7
        on_release: self.opacity = 1
        canvas.before:
            Color:
                rgba: 0.92,0.92,0.92,1
            Ellipse:
                pos: self.pos
                size: self.size

    Button:
        text: "1"
        font_size: "22sp"
        size_hint: None, None
        size: dp(70), dp(70)
        pos_hint: {"right": 0.75, "center_y": 0.18}
        background_normal: ""
        background_color: 0,0,0,0
        on_press: self.opacity = 0.7
        on_release: self.opacity = 1
        canvas.before:
            Color:
                rgba: 0.92,0.92,0.92,1
            Ellipse:
                pos: self.pos
                size: self.size

    # ================= HOME =================
    Button:
        text: "H"
        font_size: "1sp"
        color: 0,0,0,0
        size_hint: None, None
        size: dp(56), dp(56)
        pos_hint: {"x": 0.03, "y": 0.03}
        background_normal: "assets/icons/home-page.png"
        background_down: "assets/icons/home-page.png"
        border: 0,0,0,0
        allow_stretch: True
        keep_ratio: True
        on_press: self.opacity = 0.6
        on_release: self.opacity = 1

RootLayout:


# =========================================================
# SETTINGS POPUP
# =========================================================
<SettingsLayout>:
    orientation: "vertical"
    padding: dp(16)
    spacing: dp(12)

    canvas.before:
        Color:
            rgba: 0.15,0.15,0.15,1
        Rectangle:
            pos: self.pos
            size: self.size

    Label:
        text: "DEVICE SETTINGS"
        size_hint_y: None
        height: dp(32)
        color: 1,1,1,1
        bold: True

    Label:
        text: "Device name"
        size_hint_y: None
        height: dp(24)
        color: 0.8,0.8,0.8,1

    TextInput:
        text: root.username
        multiline: False
        size_hint_y: None
        height: dp(42)
        background_color: 0.2,0.2,0.2,1
        foreground_color: 1,1,1,1
        on_text: root.username = self.text

    BoxLayout:
        size_hint_y: None
        height: dp(36)
        spacing: dp(8)

        CheckBox:
            active: root.use_manual
            on_active: root.use_manual = self.active

        Label:
            text: "Use manual IP/Port"
            color: 0.8,0.8,0.8,1

    Label:
        text: "Server IP"
        size_hint_y: None
        height: dp(24)
        color: 0.8,0.8,0.8,1

    TextInput:
        text: root.manual_ip
        multiline: False
        disabled: not root.use_manual
        size_hint_y: None
        height: dp(42)
        background_color: 0.2,0.2,0.2,1
        foreground_color: 1,1,1,1
        on_text: root.manual_ip = self.text

    Label:
        text: "Data Port"
        size_hint_y: None
        height: dp(24)
        color: 0.8,0.8,0.8,1

    TextInput:
        text: str(root.manual_port)
        multiline: False
        input_filter: "int"
        disabled: not root.use_manual
        size_hint_y: None
        height: dp(42)
        background_color: 0.2,0.2,0.2,1
        foreground_color: 1,1,1,1
        on_text: root.manual_port = int(self.text) if self.text else root.manual_port

    Button:
        text: "SAVE"
        size_hint_y: None
        height: dp(48)
        background_normal: ""
        background_color: 0.2,0.6,0.8,1
        on_release: root.save_settings()
